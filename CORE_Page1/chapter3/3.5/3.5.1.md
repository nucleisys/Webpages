### **3.5.1. 从mepc定义的PC地址开始执行**

在进入异常时，mepc寄存器被同时更新，以反映当时遇到异常的指令PC值。通过这个机制，意味着mret指令执行后处理器回到了当时遇到异常的指令的PC地址，从而可以继续执行之前被中止的程序流。

注意：退出异常之前可能需要使用软件更新mepc的值。例如，如果异常由ecall或ebreak产生，由于mepc的值被更新为ecall或ebreak指令自己的PC。因此在异常返回时，如果直接使用mepc保存的PC值作为返回地址，则会再次跳回ecall或者ebreak指令，从而造成死循环（执行ecall或者ebreak指令导致重新进入异常）。正确的做法是在异常处理程序中软件改变mepc指向下一条指令，由于现在ecall/ebreak都是4字节指令，因此改写设定mepc=mepc+4即可。

