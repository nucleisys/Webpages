## **5.11. 中断嵌套**

处理器内核正在处理某个中断的过程中，可能有一个级别更高的新中断请求到来，处理器可以中止当前的中断服务程序，转而开始响应新的中断，并执行其“中断服务程序”，如此便形成了中断嵌套（即前一个中断还没响应完，又开始响应新的中断），并且嵌套的层次可以有很多层。

以图 5-7中的示例为例：

- 假设处理器正在处理计时器中断，突然有另外一个按键1中断到来（级别比计时器中断高），那么处理器会暂停处理计时器中断，开始处理按键1中断。
- 但是突然又有另外一个按键2中断到来（级别比按键1中断更高），那么处理器会暂停处理按键1的中断，开始处理按键2中断。
- 之后再没有其他更高级别的中断到来，则按键2中断不会再被打断，处理器能够顺利处理完毕按键2的中断，然后重新回到按键1中断的处理程序中去，完成按键1中断的处理。
- 完成按键1中断的处理之后，处理器会重新回到计时器中断的处理程序中去，完成计时器中断的处理。



![](5.11.assets/14.png)

​                                                                    **<center>图 5-7 中断嵌套示意图</center>**



注意：假设新来的中断请求的优先级比正在处理的中断级别低（或者相同），则处理器不应该响应这个新的中断请求，处理器必须完成当前的中断服务程序之后才考虑响应新的中断请求（因为新中断请求的级别并不比当前正在处理的中断级别高）。有关中断级别的设定请参见第6.2.9节了解更多信息。

在Bumblebee内核中，取决于中断是向量处理模式还是非向量处理模式，中断嵌套的支持方法会有所差异，请参见第5.13节了解更多详细介绍

