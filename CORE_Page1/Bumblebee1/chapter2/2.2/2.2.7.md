### **2.2.7. 中断、异常、NMI的嵌套**

中断和异常能自我发生嵌套，NMI无法自我嵌套：

- 在NMI处理模式下，如果再次发生NMI，新来的NMI会被屏蔽掉，因此，NMI无法自我嵌套，请参见第4.6节了解详情。
- 在异常处理模式下，如果再次发生异常，这属于异常嵌套情形，请参见第3.7节了解详情。
- 在中断处理模式下，如果再次发生中断，这属于中断嵌套情形，请参见第5.11节了解详情。
- 中断、异常和NMI彼此之间也可能会发生嵌套，存在如下情形：
- 在中断处理模式下发生了异常，则进入异常处理模式。
- 在NMI处理模式下发生了异常，则进入异常处理模式。
- 在中断处理模式下发生了NMI，则进入NMI处理模式。
- 在异常处理模式下发生了NMI，则进入NMI处理模式。
- 注意：在NMI和异常模式下默认由于全局中断位被硬件自动关闭，因此不会再响应中断。

为了能够保证异常和NMI彼此之间发生嵌套后还能够恢复到之前的状态（Recoverable），Bumblebee内核实现了一种“两级NMI/异常状态堆栈（Two Levels of NMI/Exception State Save Stacks）”技术，请参见第4.6节了解更多详情。