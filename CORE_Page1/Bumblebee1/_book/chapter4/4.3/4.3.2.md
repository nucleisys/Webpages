### **4.3.2. 更新CSR寄存器mepc**

Bumblebee内核退出NMI时的返回地址由CSR寄存器mepc（Machine Exception Program Counter）保存。在进入NMI时，硬件将自动更新mepc寄存器的值，该寄存器将作为退出NMI的返回地址，在NMI结束之后，能够使用它保存的PC值回到之前被停止执行的程序点。

注意：

- 出现NMI时，NMI返回地址mepc被指向下一条尚未执行的指令（因为NMI时的指令已经被正确执行）。那么在退出NMI后，程序便会回到之前的程序点，从下一条指令开始重新执行。
- 虽然mepc寄存器会在NMI发生时自动被硬件更新，但是mepc寄存器本身也是一个可读可写的寄存器，因此软件也可以直接写该寄存器以修改其值。

